import{V as e,S as t,f as o,M as n,a as s,P as i,W as a,b as r,C as l,T as h,c as d,d as c,e as m,A as u,g as p,G as w,O as g,h as v,i as b}from"./vendor.59a31a26.js";class k{constructor(n,s){this.cleanUpActions=new Array,this.object=n,this.domElement=s,this.lookDirection=new e,this.lookTarget=new e,this.spherical=new t,this.lookTargetPosition=new e,this.controllerLookSpeedCubicBezier=new o(.33,0,1,.66),this.gamepadHashTable={},this.Enabled=!0,this.MovementSpeed=1,this.MouseLookSpeed=.005,this.ControllerLookSpeed=1,this.ViewHalfX=0,this.ViewHalfY=0,this.XMovement=0,this.YMovement=0,this.ZMovement=0,this.controllerXLook=0,this.controllerYLook=0,this.mouseXLook=0,this.mouseYLook=0,this.longitude=0,this.latitude=0,this.HeightSpeed=!1,this.HeightCoefficient=1,this.HeightMin=0,this.HeightMax=1,this.AutoSpeedFactor=0,this.AutoForward=!1,this.UseController=!0,this.ActiveLook=!0,this.LookVertical=!0,this.ConstrainVertical=!1,this.VerticalMin=0,this.VerticalMax=Math.PI;let i=e=>{this.HandleOnContextMenu(e)};this.domElement.addEventListener("contextmenu",i),this.cleanUpActions.push((()=>{this.domElement.removeEventListener("contextmenu",i)}));let a=e=>{this.HandleOnMouseMove(e)};this.domElement.addEventListener("mousemove",a),this.cleanUpActions.push((()=>{this.domElement.removeEventListener("mousemove",a)}));let r=e=>{this.HandleOnMouseDown(e)};this.domElement.addEventListener("mousedown",r),this.cleanUpActions.push((()=>{this.domElement.removeEventListener("mousedown",r)}));let l=e=>{this.HandleOnMouseUp(e)};this.domElement.addEventListener("mouseup",l),this.cleanUpActions.push((()=>{this.domElement.removeEventListener("mouseup",l)}));let h=e=>{this.HandleOnKeyDown(e)};window.addEventListener("keydown",h),this.cleanUpActions.push((()=>{window.removeEventListener("keydown",h)}));let d=e=>{this.HandleOnKeyUp(e)};window.addEventListener("keyup",d),this.cleanUpActions.push((()=>{window.removeEventListener("keyup",d)}));let c=e=>{this.HandleOnControllerConnected(e)};window.addEventListener("gamepadconnected",c),this.cleanUpActions.push((()=>{window.removeEventListener("gamepadconnected",c)}));let m=e=>{this.HandleOnControllerDisconnected(e)};window.addEventListener("gamepaddisconnected",m),this.cleanUpActions.push((()=>{window.removeEventListener("gamepaddisconnected",m)})),this.HandleResize(),this.SetOrientation()}Dispose(){for(let e of this.cleanUpActions)e();this.cleanUpActions.length=0}LookAt(t,o,n){t instanceof e?this.lookTarget.copy(t):this.lookTarget.set(t,o,n),this.object.lookAt(this.lookTarget),this.SetOrientation()}Update(e){if(!1===this.Enabled)return;if(this.CheckAndProcessControllerInput(),this.HeightSpeed){const t=n.clamp(this.object.position.y,this.HeightMin,this.HeightMax)-this.HeightMin;this.AutoSpeedFactor=e*(t*this.HeightCoefficient)}else this.AutoSpeedFactor=0;const t=e*this.MovementSpeed;(Math.abs(this.ZMovement)>0||this.AutoForward)&&this.object.translateZ((t+this.AutoSpeedFactor)*this.ZMovement),Math.abs(this.XMovement)>0&&this.object.translateX(t*this.XMovement),Math.abs(this.YMovement)>0&&this.object.translateY(t*this.YMovement);let o=e*this.MouseLookSpeed;0==this.ActiveLook&&(o=0);let s=1;this.ConstrainVertical&&(s=Math.PI/(this.VerticalMax-this.VerticalMin)),Math.abs(this.mouseXLook)>0&&(this.longitude-=this.mouseXLook*o),Math.abs(this.controllerXLook)>0&&(this.longitude+=this.controllerXLook*o*this.ControllerLookSpeed),this.LookVertical&&(Math.abs(this.mouseYLook)>0&&(this.latitude-=this.mouseYLook*o*s),Math.abs(this.controllerYLook)>0&&(this.latitude+=this.controllerYLook*o*s*this.ControllerLookSpeed)),this.latitude=Math.max(-85,Math.min(85,this.latitude));let i=n.degToRad(90-this.latitude);const a=n.degToRad(this.longitude);this.ConstrainVertical&&(i=n.mapLinear(i,0,Math.PI,this.VerticalMin,this.VerticalMax));const r=this.object.position;this.lookTargetPosition.setFromSphericalCoords(1,i,a).add(r),this.object.lookAt(this.lookTargetPosition),this.mouseXLook=0,this.mouseYLook=0}HandleResize(){this.ViewHalfX=this.domElement.offsetWidth/2,this.ViewHalfY=this.domElement.offsetHeight/2}HandleOnMouseDown(e){e.preventDefault(),document.pointerLockElement==this.domElement?console.debug("The canvas already has the pointer lock."):(console.debug("The canvas does not jet have the pointer lock. Requesting..."),this.domElement.requestPointerLock())}HandleOnMouseUp(e){e.preventDefault()}HandleOnMouseMove(e){this.mouseXLook=e.movementX,this.mouseYLook=e.movementY}HandleOnKeyDown(e){switch(e.code){case"ArrowUp":case"KeyW":this.ZMovement=-1;break;case"ArrowLeft":case"KeyA":this.XMovement=-1;break;case"ArrowDown":case"KeyS":this.ZMovement=1;break;case"ArrowRight":case"KeyD":this.XMovement=1;break;case"ShiftLeft":this.YMovement=-1;break;case"Space":this.YMovement=1}}HandleOnKeyUp(e){switch(e.code){case"ArrowUp":case"KeyW":this.ZMovement=0;break;case"ArrowLeft":case"KeyA":this.XMovement=0;break;case"ArrowDown":case"KeyS":this.ZMovement=0;break;case"ArrowRight":case"KeyD":this.XMovement=0;break;case"ShiftLeft":case"Space":this.YMovement=0}}HandleOnControllerConnected(e){console.debug("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length),this.gamepadHashTable[e.gamepad.index]=e.gamepad}HandleOnControllerDisconnected(e){console.log("Gamepad disconnected from index %d: %s",e.gamepad.index,e.gamepad.id),delete this.gamepadHashTable[e.gamepad.index]}CheckAndProcessControllerInput(){const e=.05;let t=null;for(let o in this.gamepadHashTable){t=this.gamepadHashTable[o];break}if(null!=t){let o=t.axes[0],n=t.axes[1],s=0,i=t.axes[3],a=t.axes[4];Math.abs(o)<e&&(o=0),Math.abs(n)<e&&(n=0),t.buttons[11].pressed&&(s+=-1),t.buttons[0].pressed&&(s+=1),Math.abs(i)<e&&(i=0),Math.abs(a)<e&&(a=0),this.XMovement=o,this.YMovement=s,this.ZMovement=n,i=this.ScaleControllerLookAxis(i),a=this.ScaleControllerLookAxis(a),this.controllerXLook=-1*i,this.controllerYLook=-1*a}}ScaleControllerLookAxis(e){let t=this.controllerLookSpeedCubicBezier(Math.abs(e));return e<0&&(t*=-1),t}SetOrientation(){const e=this.object.quaternion;this.lookDirection.set(0,0,-1).applyQuaternion(e),this.spherical.setFromVector3(this.lookDirection),this.latitude=90-n.radToDeg(this.spherical.phi),this.longitude=n.radToDeg(this.spherical.theta)}HandleOnContextMenu(e){e.preventDefault()}}let L=new class{constructor(){this.mainScene=new s,this.playerCamera=new i(75,window.innerWidth/window.innerHeight,.1,2e3),this.mainRenderer=new a,this.stats=new r,this.stats.showPanel(0),this.clock=new l(!0),this.torus=null,this.orbitControls=null,this.firstPersonControls=null,this.overlayElement=null,this.overlayTextElement=null,document.addEventListener("pointerlockchange",(e=>{this.firstPersonControls&&this.firstPersonControls.Enabled&&(document.pointerLockElement?this.HideOverlay():this.ShowOverlay("Klicken zum steuern..."))}),!1)}Load(){console.info("Main.Load wurde aufgerufen..."),document.body.appendChild(this.stats.dom),this.overlayElement=document.querySelector(".Overlay"),this.overlayTextElement=document.querySelector(".OverlayText");let e=document.querySelector(".MainCanvas");console.debug("Renderer wird initialisieren..."),this.mainRenderer=new a({canvas:e}),console.debug("Setzte Renderer device pixel ratio auf %f...",window.devicePixelRatio),this.mainRenderer.setPixelRatio(window.devicePixelRatio),console.debug("Setzte Renderer größe auf %f x %f...",window.innerWidth,window.innerHeight),this.mainRenderer.setSize(window.innerWidth,window.innerHeight),console.debug("Bewege die Spieler-Kamera auf Z %f...",30),this.playerCamera.position.setZ(30),console.debug("Erstelle einen Torus in der mitte von der Szene...");let t=new h(10,3,16,100),o=new d({color:16723968});this.torus=new c(t,o),this.mainScene.add(this.torus);console.debug("Erstelle ein Punktlicht an %f, %f, %f mit der Farbe gelb...",20,5,5);let n=new m(16776960);n.position.set(20,5,5),this.mainScene.add(n),console.debug("Erstelle AmbientLight mit helligkeit 25%...");let s=new u(16777215,.25);this.mainScene.add(s),console.debug("Erstell einen Helper für das PointLight (damit dieses sichtbar ist)...");let i=new p(n);this.mainScene.add(i),console.debug("Erstell GridHelper, damit die höhe 0 angezeigt wird...");let r=new w(200,50);this.mainScene.add(r),console.debug("Füge Orbitalsteuerung hinzu..."),this.orbitControls=new g(this.playerCamera,this.mainRenderer.domElement),console.debug("Füge FPS-Steuerung hinzu (deaktiviert)..."),this.firstPersonControls=new k(this.playerCamera,this.mainRenderer.domElement),this.firstPersonControls.Enabled=!1,this.firstPersonControls.MouseLookSpeed=5,this.firstPersonControls.MovementSpeed=10,this.firstPersonControls.ControllerLookSpeed=50,window.addEventListener("keydown",(e=>{"KeyQ"==e.code&&(console.debug("Leertaste wurde gedrückt. Wechsle die Sterungsart..."),this.firstPersonControls.Enabled=0==this.firstPersonControls.Enabled,this.orbitControls.enabled=0==this.orbitControls.enabled,this.firstPersonControls.Enabled&&null===document.pointerLockElement?this.ShowOverlay("Klicken zum steuern..."):this.HideOverlay(),this.orbitControls.enabled&&document.exitPointerLock())})),console.debug("Füge 200 Sterne (Sphären) an zufälligen Koordinaten hinzu...");for(let a=0;a<200;a++)this.AddStar();let l=(new v).load("space.jpg");this.mainScene.background=l;let L=(new v).load("moon.jpg"),M=(new v).load("normal.jpg");console.debug("Füge einen Sphäre mit Mond-Textur und -Noramltextur in der mitte der Szene hinzu...");let S=new c(new b(3,32,32),new d({map:L,normalMap:M}));this.mainScene.add(S),console.debug("Starte die Gameloop..."),this.GameLoop()}GameLoop(){var e,t;this.stats.begin(),null!=this.torus&&(this.torus.rotation.x+=.01,this.torus.rotation.y+=.005,this.torus.rotation.z+=.01),null!=this.orbitControls&&this.orbitControls.enabled&&(null==(e=this.orbitControls)||e.update()),null!=this.firstPersonControls&&this.firstPersonControls.Enabled&&(null==(t=this.firstPersonControls)||t.Update(this.clock.getDelta())),this.mainRenderer.render(this.mainScene,this.playerCamera),this.stats.end(),requestAnimationFrame((()=>{this.GameLoop()}))}AddStar(){let e=new b(.25),t=new d({color:16777215}),o=new c(e,t);o.position.set(n.randFloatSpread(100),n.randFloatSpread(100),n.randFloatSpread(100)),this.mainScene.add(o)}ShowOverlay(e){if(null==this.overlayElement||null==this.overlayTextElement)throw new Error("Overlay-HTML-Element are null. Did you call Load()?");this.overlayElement.classList.remove("Hide"),this.overlayTextElement.innerText=e}HideOverlay(){if(null==this.overlayElement||null==this.overlayTextElement)throw new Error("Overlay-HTML-Element are null. Did you call Load()?");this.overlayElement.classList.add("Hide"),this.overlayTextElement.innerText=""}};setTimeout((()=>{L.Load()}),0);
